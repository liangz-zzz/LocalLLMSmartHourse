# 户型编辑与 3D 预览需求

版本：v0.1（2026-01-04）

## 目标
- 支持用户上传 2D 户型图（PNG/JPG）与 3D 模型（GLB），在同一页面完成编辑与预览。
- 2D 视图用于房间边界与设备位置编辑，3D 视图用于效果预览。
- 设备支持高度（m，小数）设置，便于 3D 坐标映射。
- 数据本机持久化，不入库、不上传第三方，且不进入 Git 仓库。

## 功能需求
1) 资产上传
- 前端上传 PNG/JPG/GLB，后端保存到本机目录并返回可访问 URL。
- 上传大小限制：PNG/JPG 20MB、GLB 200MB；支持配置覆盖。
- 任一资源更新后，标记校准失效并要求重新校准。

2) 户型配置
- 单家庭单文件 `floorplans.json`，可包含多张户型图（楼层/区域）。
- 提供增删改查 API，用于前端编辑与保存。

3) 房间编辑
- 用户在 2D 视图中手工绘制多边形并命名房间。
- 支持顶点拖拽、重命名、删除。

4) 设备编辑
- 2D 视图中拖拽/旋转/缩放设备，并设置高度（单位 m，可小数）。
- 拖拽完成后自动计算所属房间（point-in-polygon）。

5) 3D 预览
- 使用 GLB 进行 3D 预览；需完成三点校准后才能启用。
- 设备效果采用标记/光晕/颜色叠加展示，不要求模型内部动画。

6) 场景预览
- 读取 `/scenes` 与 `/scenes/:id/expanded`，在 2D/3D 中显示场景效果。
- 默认仅预览，执行需显式按钮并二次确认。
- 首期支持灯光、窗帘、空调、插座/开关；其他设备以高亮标记呈现。

7) 实时状态
- 视图模式订阅 WebSocket 设备状态；编辑模式可暂停订阅。

8) 安全与合规
- API 走现有 API Key/JWT 机制。
- 资产与配置仅存放本地 `CONFIG_DIR`，不进入 Git。
